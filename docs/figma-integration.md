# Figma Integration Guide for Production Tool 2.0

This guide explains how to set up and use the Figma-to-code pipeline for efficient UI development.

## Overview

The Production Tool 2.0 leverages Figma's design capabilities with AI-powered code generation through:

1. **Figma MCP (Model Context Protocol)** - Direct design-to-Claude connection
2. **Figma Code Connect** - Component mapping between design and code
3. **Dev Mode** - Design handoff with specifications

## Setup Instructions

### 1. Figma Desktop App Setup

Install and configure the Figma desktop app:

```bash
# macOS
brew install --cask figma

# Windows/Linux
# Download from https://www.figma.com/downloads/
```

### 2. Enable Dev Mode

1. Open Figma desktop app
2. Go to Preferences â†’ Beta
3. Enable "Dev Mode"
4. Restart Figma

### 3. Configure MCP Server Connection

#### For Claude Desktop

Add to your Claude configuration file:

```json
{
  "mcpServers": {
    "figma-dev-mode": {
      "type": "sse",
      "url": "http://localhost:3845/sse"
    }
  }
}
```

#### For Cursor

In `.cursor/config.json`:

```json
{
  "mcp": {
    "servers": {
      "Figma Dev Mode MCP": {
        "type": "sse",
        "url": "http://127.0.0.1:3845/sse"
      }
    }
  }
}
```

### 4. Install Figma Code Connect

```bash
npm install -D @figma/code-connect
```

Create `figma.config.json`:

```json
{
  "codeConnect": {
    "include": ["src/components/**/*.tsx"],
    "parser": "react",
    "importPaths": {
      "src/components/*": "@/components/*"
    }
  }
}
```

## Component Mapping

### 1. Connect Figma Components to Code

Create a Code Connect file for each component:

```typescript
// src/components/ui/button.figma.tsx
import figma from '@figma/code-connect/react'
import { Button } from './button'

figma.connect(Button, 'https://figma.com/file/YOUR_FILE_ID/YOUR_FILE_NAME?node-id=COMPONENT_ID', {
  props: {
    children: figma.string('Label'),
    variant: figma.enum('Variant', {
      'Primary': 'primary',
      'Secondary': 'secondary',
      'Destructive': 'destructive',
    }),
    size: figma.enum('Size', {
      'Small': 'sm',
      'Medium': 'md',
      'Large': 'lg',
    }),
    disabled: figma.boolean('Disabled'),
    loading: figma.boolean('Loading'),
  },
  example: ({ children, variant, size, disabled, loading }) => (
    <Button 
      variant={variant} 
      size={size} 
      disabled={disabled || loading}
    >
      {loading ? 'Loading...' : children}
    </Button>
  ),
})
```

### 2. Publish Code Connect

```bash
# Login to Figma
npx figma connect auth

# Publish connections
npx figma connect publish
```

## Design System Structure

### Figma File Organization

```
Production Tool 2.0 Design System/
â”œâ”€â”€ ðŸŽ¨ Foundations/
â”‚   â”œâ”€â”€ Colors
â”‚   â”œâ”€â”€ Typography
â”‚   â”œâ”€â”€ Spacing
â”‚   â””â”€â”€ Effects
â”œâ”€â”€ ðŸ“¦ Components/
â”‚   â”œâ”€â”€ Buttons
â”‚   â”œâ”€â”€ Forms
â”‚   â”œâ”€â”€ Cards
â”‚   â””â”€â”€ Modals
â”œâ”€â”€ ðŸ“„ Pages/
â”‚   â”œâ”€â”€ Dashboard
â”‚   â”œâ”€â”€ Booking Flow
â”‚   â””â”€â”€ Project Management
â””â”€â”€ ðŸ”§ Documentation/
    â”œâ”€â”€ Component Guidelines
    â””â”€â”€ Usage Examples
```

### Variable Naming Convention

Use consistent naming for easy AI interpretation:

```
Colors:
- primary/500 â†’ var(--primary)
- neutral/100 â†’ var(--neutral-100)

Spacing:
- spacing/4 â†’ 1rem
- spacing/8 â†’ 2rem

Typography:
- heading/1 â†’ text-4xl font-bold
- body/regular â†’ text-base
```

## Workflow Integration

### 1. Designer Workflow

1. Create/update component in Figma
2. Use Auto Layout for responsive behavior
3. Apply consistent naming and variables
4. Add component descriptions and usage notes
5. Mark as "Ready for Development" in Dev Mode

### 2. Developer Workflow

1. Open Figma file in Dev Mode
2. Select component to implement
3. Use Claude/Cursor with MCP connection:

```
"Implement the BookingCard component from the selected Figma design. 
Use our existing Button and Avatar components from shadcn/ui."
```

4. Claude generates component with:
   - Correct styling from Figma
   - Type-safe props
   - Responsive behavior
   - Accessibility features

### 3. Component Example

Input from Figma â†’ Output in Code:

```typescript
// Generated by Claude from Figma design
import { Card, CardHeader, CardContent } from '@/components/ui/card'
import { Avatar, AvatarImage, AvatarFallback } from '@/components/ui/avatar'
import { Badge } from '@/components/ui/badge'
import { formatDate } from '@/lib/utils'

interface BookingCardProps {
  artistName: string
  artistAvatar?: string
  projectName: string
  startTime: Date
  endTime: Date
  status: 'hold' | 'pencil' | 'confirmed'
}

export function BookingCard({
  artistName,
  artistAvatar,
  projectName,
  startTime,
  endTime,
  status
}: BookingCardProps) {
  const statusColors = {
    hold: 'bg-yellow-100 text-yellow-800',
    pencil: 'bg-blue-100 text-blue-800',
    confirmed: 'bg-green-100 text-green-800'
  }

  return (
    <Card className="hover:shadow-lg transition-shadow">
      <CardHeader className="flex flex-row items-center gap-4">
        <Avatar>
          <AvatarImage src={artistAvatar} alt={artistName} />
          <AvatarFallback>{artistName.slice(0, 2).toUpperCase()}</AvatarFallback>
        </Avatar>
        <div className="flex-1">
          <h3 className="font-semibold">{artistName}</h3>
          <p className="text-sm text-muted-foreground">{projectName}</p>
        </div>
        <Badge className={statusColors[status]}>{status}</Badge>
      </CardHeader>
      <CardContent>
        <div className="flex justify-between text-sm">
          <span>{formatDate(startTime, 'MMM d, h:mm a')}</span>
          <span>â†’</span>
          <span>{formatDate(endTime, 'MMM d, h:mm a')}</span>
        </div>
      </CardContent>
    </Card>
  )
}
```

## Best Practices

### Design Guidelines

1. **Use Components**: Create reusable components for consistency
2. **Auto Layout**: Set up proper constraints for responsive design
3. **Semantic Naming**: Use descriptive names (e.g., "BookingCard" not "Card12")
4. **Variables**: Define design tokens for colors, spacing, typography
5. **Variants**: Create component variants for different states
6. **Documentation**: Add usage notes and interaction details

### Development Guidelines

1. **Component Mapping**: Always create Code Connect files
2. **Type Safety**: Define proper TypeScript interfaces
3. **Accessibility**: Include ARIA labels and keyboard navigation
4. **Performance**: Use React.memo for expensive components
5. **Testing**: Write tests for generated components

## Troubleshooting

### Common Issues

**MCP Connection Failed**
```bash
# Check if Figma is running
ps aux | grep Figma

# Verify port availability
lsof -i :3845

# Restart Figma desktop app
```

**Code Connect Not Working**
```bash
# Clear cache
rm -rf .figma

# Re-authenticate
npx figma connect auth

# Re-publish connections
npx figma connect publish --force
```

**Component Not Found**
- Ensure component is marked as "Component" in Figma
- Check node ID is correct
- Verify file permissions

## Advanced Features

### 1. Dynamic Component Generation

Use AI to generate variations:

```
"Create a responsive grid layout for the BookingCard component 
that adapts from 1 column on mobile to 3 columns on desktop"
```

### 2. Design Token Sync

Automatically sync design tokens:

```typescript
// scripts/sync-design-tokens.ts
import { getFigmaVariables } from '@figma/code-connect'

async function syncTokens() {
  const tokens = await getFigmaVariables(FIGMA_FILE_ID)
  
  // Generate CSS variables
  const css = generateCSSVariables(tokens)
  fs.writeFileSync('src/styles/tokens.css', css)
  
  // Generate TypeScript types
  const types = generateTypeScript(tokens)
  fs.writeFileSync('src/types/tokens.ts', types)
}
```

### 3. Component Library Documentation

Auto-generate Storybook stories from Figma:

```typescript
// .storybook/figma-loader.js
export async function generateStories() {
  const components = await getFigmaComponents()
  
  components.forEach(component => {
    const story = generateStoryTemplate(component)
    fs.writeFileSync(
      `src/stories/${component.name}.stories.tsx`,
      story
    )
  })
}
```

## Resources

- [Figma Dev Mode Documentation](https://help.figma.com/hc/en-us/articles/15023124644247)
- [Figma Code Connect Guide](https://www.figma.com/developers/code-connect)
- [MCP Protocol Specification](https://modelcontextprotocol.io)
- [Claude Desktop Configuration](https://claude.ai/docs/desktop-config)

---

With this integration, you can streamline the design-to-code workflow, ensuring consistency between Figma designs and the implemented components while leveraging AI for rapid development.